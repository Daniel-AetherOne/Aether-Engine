{% extends "app/layout.html" %}
{% block content %}
<h2 style="margin:0 0 12px 0;">Leads</h2>

<table>
  <thead>
    <tr>
      <th>Customer</th>
      <th>Status</th>
      <th>Estimate</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for lead in leads %}
    <tr>
      <td>
        <div style="font-weight:600;">{{ lead.customer_name or "—" }}</div>
        <div class="muted">{{ lead.address or "" }}</div>
      </td>
      <td><span class="badge {{ lead.status }}">{{ lead.status }}</span></td>
      <td class="muted">
        {% if lead.estimate_html_key %}HTML ✓{% else %}—{% endif %}
        {% if lead.total is not none %}<div>${{ "%.2f"|format(lead.total) }}</div>{% endif %}
      </td>
      <td>
        {% set a = lead.next_action %}
        {% if a and a.method == "POST" %}
          <form method="post" action="{{ a.href }}" style="display:inline;">
            <button class="btn" type="submit">{{ a.label }}</button>
          </form>
        {% elif a %}
          <a class="btn" href="{{ a.href }}">{{ a.label }}</a>
        {% else %}
          <a class="btn" href="/app/leads/{{ lead.id }}">Open</a>
        {% endif %}

        {% if lead.public_url %}
          <button class="btn" type="button"
            style="margin-left:8px;"
            onclick="copyText('{{ lead.public_url }}')">Copy link</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert("Copied!");
    }).catch(() => {
      prompt("Copy this:", text);
    });
  }
</script>
{% endblock %}
